<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fleuris - Your Garden of Unique Brands</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  :root {
    --primary-green: #a8d5ba;
    --primary-dark-green: #6a8e6d;
    --primary-light-green: #d7f1e6;
    --accent-pink: #f6c1c1;
    --text-dark: #333;
    --text-light: #555;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0; font-family: 'Montserrat', sans-serif;
    background: var(--primary-light-green);
    color: var(--text-dark);
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background: var(--primary-green);
    padding: 1rem;
    text-align: center;
    color: white;
    font-weight: 700;
    font-size: 1.8rem;
    letter-spacing: 0.05em;
  }
  main {
    flex: 1;
    padding: 1rem;
    max-width: 480px;
    margin: auto;
  }
  h1 {
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  p {
    margin-top: 0; margin-bottom: 1.5rem;
    color: var(--text-light);
    line-height: 1.5;
  }
  button {
    background: var(--primary-green);
    border: none;
    padding: 1rem 2rem;
    font-weight: 700;
    color: white;
    border-radius: 25px;
    cursor: pointer;
    font-size: 1.1rem;
    margin: 0.5rem;
    transition: background 0.3s ease;
  }
  button:hover {
    background: var(--primary-dark-green);
  }
  .auth-buttons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
  }
  .modal-bg {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 100;
  }
  .modal {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    width: 90%;
    max-width: 350px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
  }
  .modal h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-weight: 700;
    color: var(--primary-dark-green);
  }
  .modal label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-dark);
  }
  .modal input {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    border: 1px solid var(--primary-green);
    border-radius: 5px;
    font-size: 1rem;
  }
  .modal .role-select {
    margin-bottom: 1.5rem;
  }
  .modal .close-btn {
    background: var(--accent-pink);
    color: var(--text-dark);
  }
  .modal .close-btn:hover {
    background: #f48c8c;
  }
  .error-msg {
    color: #d9534f;
    margin-bottom: 1rem;
    font-weight: 600;
  }
</style>
</head>
<body>
<header>Fleuris</header>
<main>
  <h1>Your Garden of Unique Brands</h1>
  <p>Discover & support unique fashion brands from creators you love. Join Fleuris as a buyer or seller and start your journey today.</p>
  <div class="auth-buttons">
    <button id="btnSignUp">Sign Up</button>
    <button id="btnLogIn">Log In</button>
  </div>
</main>

<!-- Modal for signup/login -->
<div class="modal-bg" id="modalAuth">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <h2 id="authTitle">Sign Up</h2>
    <form id="formAuth">
      <label for="inputName">Full Name</label>
      <input type="text" id="inputName" name="fullName" required autocomplete="name" />
      
      <label for="inputEmail">Email</label>
      <input type="email" id="inputEmail" name="email" required autocomplete="email" />
      
      <label for="inputPassword">Password</label>
      <input type="password" id="inputPassword" name="password" required autocomplete="new-password" minlength="6" />
      
      <label class="role-select">Register as:</label>
      <select id="selectRole" name="role" required>
        <option value="buyer" selected>Buyer</option>
        <option value="seller">Seller</option>
      </select>
      
      <div class="error-msg" id="authError" role="alert"></div>
      
      <button type="submit" id="btnSubmitAuth">Sign Up</button>
      <button type="button" class="close-btn" id="btnCloseModal">Cancel</button>
    </form>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAx7DAvkZupSDXg4aXWvtfSQWhqX32Kwrs",
    authDomain: "fleuris-3df99.firebaseapp.com",
    projectId: "fleuris-3df99",
    storageBucket: "fleuris-3df99.appspot.com",
    messagingSenderId: "831344111439",
    appId: "1:831344111439:web:REPLACE_THIS"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const modal = document.getElementById('modalAuth');
  const btnSignUp = document.getElementById('btnSignUp');
  const btnLogIn = document.getElementById('btnLogIn');
  const btnClose = document.getElementById('btnCloseModal');
  const formAuth = document.getElementById('formAuth');
  const authTitle = document.getElementById('authTitle');
  const authError = document.getElementById('authError');
  const btnSubmitAuth = document.getElementById('btnSubmitAuth');

  let isLoginMode = false;

  btnSignUp.addEventListener('click', () => {
    isLoginMode = false;
    openModal();
  });
  btnLogIn.addEventListener('click', () => {
    isLoginMode = true;
    openModal();
  });
  btnClose.addEventListener('click', closeModal);

  function openModal() {
    modal.style.display = 'flex';
    authError.textContent = '';
    if (isLoginMode) {
      authTitle.textContent = 'Log In';
      btnSubmitAuth.textContent = 'Log In';
      formAuth.inputName.style.display = 'none';
    } else {
      authTitle.textContent = 'Sign Up';
      btnSubmitAuth.textContent = 'Sign Up';
      formAuth.inputName.style.display = 'block';
    }
  }

  function closeModal() {
    modal.style.display = 'none';
    formAuth.reset();
  }

  formAuth.addEventListener('submit', async (e) => {
    e.preventDefault();
    authError.textContent = '';
    const email = formAuth.inputEmail.value.trim();
    const password = formAuth.inputPassword.value.trim();
    const role = formAuth.selectRole.value;
    const fullName = formAuth.inputName.value.trim();

    try {
      if (isLoginMode) {
        // Log In
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        redirectUser(userCredential.user.uid);
      } else {
        // Sign Up
        if (!fullName) {
          authError.textContent = 'Please enter your full name.';
          return;
        }
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        await setDoc(doc(db, "users", user.uid), {
          uid: user.uid,
          fullName,
          email,
          role,
          coins: 0,
          createdAt: new Date()
        });
        redirectUser(user.uid);
      }
    } catch (error) {
      authError.textContent = error.message;
    }
  });

  function redirectUser(uid) {
    getDoc(doc(db, "users", uid)).then(docSnap => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        if (data.role === "seller") {
          window.location.href = "seller.html";
        } else {
          window.location.href = "home.html";
        }
      } else {
        authError.textContent = "User data not found.";
      }
    });
  }

  // If user is already logged in, redirect
  onAuthStateChanged(auth, user => {
    if (user) {
      redirectUser(user.uid);
    }
  });
</script>
</body>
</html>
